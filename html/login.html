<html>
<head><title>Shamradio - Login</title></head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
      @import url("/css/style.css");
      @import url("/css/home.css");
  </style>

  <script src="/socket.io/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <body>
    <div id="header">
      <a id="sitename" href="/"><img id="logo" src="/img/logo.png" height="70px"/>Shamradio</a>

    </div>
    <div id="mainscreen">
      <h1>Login</h1>
      <div id="login">
        <input id="username" placeholder="Username" autocomplete="on" autocapitalize="off"/><br>
        <input id="password" placeholder="Password" type="password" autocomplete="on" autocapitalize="off"/><br>
        <button onclick="login()" class="button-cool">Login</button>
      </div>

      <div id="register" action="">
        <h1>Register</h1>
        <input id="r-username" placeholder="Username" autocomplete="on" autocapitalize="off"/><br>
        <input id="r-password" type="password"  placeholder="Password" autocomplete="on" autocapitalize="off"/><br>
        <input id="r-password-2" type="password"  placeholder="Repeat Password" autocomplete="on" autocapitalize="off"/><br>
        <button onclick="register()" class="button-cool">Register</button>
      </div>

      <div id="nickname" action="">
        <h1>Play as Guest</h1>
        <input id="n-name" placeholder="Nickname" autocomplete="on" autocapitalize="off"/><br>
        <button onclick="nickname()" class="button-cool">Play</button>
      </div>
    </div>
    <div id="mainscreen-bg"></div>
    <script>
      var socket = io();
      var url = new URL(window.location.href);
      var redirect = url.searchParams.get('r');

      if (redirect==null) {
        $('#nickname').css('display','none');
      }
      else {
        $('#register').css('display','none');
      }

      function login() {
        socket.emit('login',$('#username').val(),$('#password').val());
      }

      function register() {
        if($('#r-password').val()==$('#r-password-2').val())
        {
          socket.emit('register',$('#r-username').val(),$('#r-password').val());
        }
      }

      function nickname() {
        var nickname = $('#n-name').val();
        if (nickname.trim()=='') {
          nickname = 'Guest';
        }
        window.location.href = ('/game/'+redirect+'?name='+nickname);
      }

      socket.on('loginresponse', function(userSession){
        document.cookie = "userSession="+userSession;

        if(redirect==null) {
          window.location.href = "/account";
        }
        else {
          window.location.href = "/game/"+redirect;
        }
      });

      socket.on('errormessage', function(msg){
        alert(msg);
      });

    </script>
</html>
